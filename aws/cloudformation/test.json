{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "Data layer for Tableau including RedShift cluster configuration and scheduled Data Pipeline activities.",
  "Parameters": {
    "RedshiftPassword": {
      "Type": "String",
      "NoEcho": true
    },
    "RDSPassword": {
      "Type": "String",
      "NoEcho": true
    },
    "RedshiftUsername": {
      "Type": "String",
      "Default": "dev"
    },
    "RDSUsername": {
      "Type": "String"
    },
    "RedshiftS3": {
      "Type": "String",
      "Default": "s3://redshift-tableau/Tableau"
    },
    "RedshiftDatabase": {
      "Type": "String",
      "Default": "dashboard"
    },
    "RDSHostname": {
      "Type": "String"
    },
    "RDSPort": {
      "Type": "Number",
      "Default": 3306
    }
  },
  "Resources": {
    "VPC": {
      "Type": "Custom::LookupStackOutputs",
      "Properties": {
        "ServiceToken": {
          "Fn::Join": [
            ":",
            [
              "arn:aws:lambda",
              {
                "Ref": "AWS::Region"
              },
              {
                "Ref": "AWS::AccountId"
              },
              "function",
              "LookupStackOutputs"
            ]
          ]
        },
        "StackName": "VPC",
        "Nonce": 0
      }
    },
    "Tableau": {
      "Type": "AWS::Redshift::Cluster",
      "Properties": {
        "AllowVersionUpgrade": true,
        "AutomatedSnapshotRetentionPeriod": 1,
        "ClusterParameterGroupName": "default.redshift-1.0",
        "ClusterSubnetGroupName": {
          "Fn::GetAtt": [
            "VPC",
            "RedshiftSubnetGroup"
          ]
        },
        "ClusterType": "single-node",
        "ClusterVersion": 1.0,
        "DBName": {
          "Ref": "RedshiftDatabase"
        },
        "Encrypted": true,
        "KmsKeyId": "alias/aws/redshift",
        "MasterUsername": {
          "Ref": "RedshiftUsername"
        },
        "MasterUserPassword": {
          "Ref": "RedshiftPassword"
        },
        "NodeType": "dc1.large",
        "PubliclyAccessible": true,
        "VpcSecurityGroupIds": [
          {
            "Fn::GetAtt": [
              "VPC",
              "RedshiftSecurityGroup"
            ]
          }
        ]
      }
    },
    "RDSSyncDashboard": {
      "Type": "AWS::DataPipeline::Pipeline",
      "Properties": {
        "Name": "rds-to-redshift-dashboard",
        "Description": "Sync RDS-dashboard to Redshift",
        "ParameterObjects": [
          {
            "Id": "*myRDSPassword",
            "Attributes": [
              {
                "Key": "description",
                "StringValue": "RDS MySQL password"
              },
              {
                "Key": "type",
                "StringValue": "String"
              }
            ]
          },
          {
            "Id": "myRedshiftUsername",
            "Attributes": [
              {
                "Key": "description",
                "StringValue": "Redshift username"
              },
              {
                "Key": "type",
                "StringValue": "String"
              }
            ]
          },
          {
            "Id": "myRDSJdbcConnectStr",
            "Attributes": [
              {
                "Key": "watermark",
                "StringValue": "jdbc:mysql://dbinstance.id.region.rds.amazonaws.com:3306/dbname"
              },
              {
                "Key": "description",
                "StringValue": "RDS MySQL connection string"
              },
              {
                "Key": "type",
                "StringValue": "String"
              }
            ]
          },
          {
            "Id": "myS3StagingLoc",
            "Attributes": [
              {
                "Key": "helpText",
                "StringValue": "The S3 folder to store RDS MySQL table data before loading to Redshift. The S3 folder must be in the same region as the Redshift cluster."
              },
              {
                "Key": "description",
                "StringValue": "S3 staging folder"
              },
              {
                "Key": "type",
                "StringValue": "AWS::S3::ObjectKey"
              }
            ]
          },
          {
            "Id": "myRedshiftTypeConvOverrideMap",
            "Attributes": [
              {
                "Key": "helpText",
                "StringValue": "Override the default mapping of RDS MySQL data types to Redshift data types."
              },
              {
                "Key": "watermark",
                "StringValue": "tinyint(1):smallint,char(35):varchar(70),bigint(20) unsigned:bigint"
              },
              {
                "Key": "description",
                "StringValue": "MySQL to Redshift type conversion overrides"
              },
              {
                "Key": "optional",
                "StringValue": "true"
              },
              {
                "Key": "type",
                "StringValue": "String"
              }
            ]
          },
          {
            "Id": "myRedshiftDistributionKey",
            "Attributes": [
              {
                "Key": "watermark",
                "StringValue": "columnName"
              },
              {
                "Key": "helpText",
                "StringValue": "Distribution key column in the Redshift table. If the distribution key is not specified, the primary key is set as a distribution key."
              },
              {
                "Key": "description",
                "StringValue": "Redshift table distribution key"
              },
              {
                "Key": "optional",
                "StringValue": "true"
              },
              {
                "Key": "type",
                "StringValue": "String"
              }
            ]
          },
          {
            "Id": "myInsertMode",
            "Attributes": [
              {
                "Key": "default",
                "StringValue": "OVERWRITE_EXISTING"
              },
              {
                "Key": "helpLink",
                "StringValue": "https://docs.aws.amazon.com/console/datapipeline/redshiftcopyactivity"
              },
              {
                "Key": "helpText",
                "StringValue": "Determines how to handle pre-existing data in the target table that overlaps with rows in the data to be loaded."
              },
              {
                "Key": "description",
                "StringValue": "Redshift table insert mode"
              },
              {
                "Key": "type",
                "StringValue": "String"
              }
            ]
          },
          {
            "Id": "*myRedshiftPassword",
            "Attributes": [
              {
                "Key": "description",
                "StringValue": "Redshift password"
              },
              {
                "Key": "type",
                "StringValue": "String"
              }
            ]
          },
          {
            "Id": "myRDSTableLastModifiedCol",
            "Attributes": [
              {
                "Key": "helpText",
                "StringValue": "Name of the column that stores the last modified time value in the RDS MySQL table."
              },
              {
                "Key": "description",
                "StringValue": "Last modified column name"
              },
              {
                "Key": "type",
                "StringValue": "String"
              }
            ]
          },
          {
            "Id": "myRDSRedshiftSecurityGrps",
            "Attributes": [
              {
                "Key": "default",
                "StringValue": "default"
              },
              {
                "Key": "watermark",
                "StringValue": "security group name"
              },
              {
                "Key": "helpText",
                "StringValue": "The names of one or more security groups that collectively provide the EC2 instance connectivity to both the RDS instance and Redshift cluster."
              },
              {
                "Key": "description",
                "StringValue": "RDS and Redshift security group(s)"
              },
              {
                "Key": "isArray",
                "StringValue": "true"
              },
              {
                "Key": "type",
                "StringValue": "String"
              }
            ]
          },
          {
            "Id": "myRDSUsername",
            "Attributes": [
              {
                "Key": "description",
                "StringValue": "RDS MySQL username"
              },
              {
                "Key": "type",
                "StringValue": "String"
              }
            ]
          },
          {
            "Id": "myRedshiftSortKeys",
            "Attributes": [
              {
                "Key": "watermark",
                "StringValue": "columnName1,columnName2"
              },
              {
                "Key": "helpText",
                "StringValue": "Sort key columns in the Redshift table."
              },
              {
                "Key": "description",
                "StringValue": "Redshift table sort keys"
              },
              {
                "Key": "optional",
                "StringValue": "true"
              },
              {
                "Key": "type",
                "StringValue": "String"
              }
            ]
          },
          {
            "Id": "myRedshiftJdbcConnectStr",
            "Attributes": [
              {
                "Key": "watermark",
                "StringValue": "jdbc:postgresql://endpoint:port/database?tcpKeepAlive=true"
              },
              {
                "Key": "description",
                "StringValue": "Redshift JDBC connection string"
              },
              {
                "Key": "type",
                "StringValue": "String"
              }
            ]
          }
        ],
        "ParameterValues": [
          {
            "Id": "myS3StagingLoc",
            "StringValue": {
              "Fn::Join": [
                "/",
                [
                  {
                    "Ref": "RedshiftS3"
                  },
                  "dashboard_production"
                ]
              ]
            }
          },
          {
            "Id": "myRDSTableLastModifiedCol",
            "StringValue": "updated_at"
          },
          {
            "Id": "myRDSJdbcConnectStr",
            "StringValue": {
              "Fn::Join": [
                "",
                [
                  "jdbc:mysql://",
                  {
                    "Ref": "RDSHostname"
                  },
                  ":",
                  {
                    "Ref": "RDSPort"
                  },
                  "/",
                  "dashboard_production"
                ]
              ]
            }
          },
          {
            "Id": "myRDSUsername",
            "StringValue": {
              "Ref": "RDSUsername"
            }
          },
          {
            "Id": "*myRDSPassword",
            "StringValue": {
              "Ref": "RDSPassword"
            }
          },
          {
            "Id": "myRDSRedshiftSecurityGrps",
            "StringValue": {
              "Fn::GetAtt": [
                "VPC",
                "FrontendSecurityGroup"
              ]
            }
          },
          {
            "Id": "myRedshiftJdbcConnectStr",
            "StringValue": {
              "Fn::Join": [
                "",
                [
                  "jdbc:redshift://",
                  {
                    "Fn::GetAtt": [
                      "Tableau",
                      "Endpoint.Address"
                    ]
                  },
                  ":",
                  {
                    "Fn::GetAtt": [
                      "Tableau",
                      "Endpoint.Port"
                    ]
                  },
                  "/",
                  {
                    "Ref": "RedshiftDatabase"
                  },
                  "?tcpKeepAlive=true"
                ]
              ]
            }
          },
          {
            "Id": "myRedshiftUsername",
            "StringValue": {
              "Ref": "RedshiftUsername"
            }
          },
          {
            "Id": "*myRedshiftPassword",
            "StringValue": {
              "Ref": "RedshiftPassword"
            }
          },
          {
            "Id": "myInsertMode",
            "StringValue": "OVERWRITE_EXISTING"
          },
          {
            "Id": "myEc2InstanceSubnet",
            "StringValue": {
              "Fn::GetAtt": [
                "VPC",
                "SubnetB"
              ]
            }
          }
        ],
        "PipelineObjects": [
          {
            "Id": "Default",
            "Name": "Default",
            "Fields": [
              {
                "Key": "failureAndRerunMode",
                "StringValue": "CASCADE"
              },
              {
                "Key": "schedule",
                "RefValue": "DefaultSchedule"
              },
              {
                "Key": "resourceRole",
                "StringValue": "DataPipelineDefaultResourceRole"
              },
              {
                "Key": "role",
                "StringValue": "DataPipelineDefaultRole"
              },
              {
                "Key": "pipelineLogUri",
                "StringValue": "s3://redshift-tableau"
              },
              {
                "Key": "scheduleType",
                "StringValue": "cron"
              },
              {
                "Key": "type",
                "StringValue": "Default"
              }
            ]
          },
          {
            "Id": "DefaultSchedule",
            "Name": "Every 1 day",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "Schedule"
              },
              {
                "Key": "period",
                "StringValue": "1 days"
              },
              {
                "Key": "startDateTime",
                "StringValue": "2016-06-27T07:45:00"
              }
            ]
          },
          {
            "Id": "Ec2Instance",
            "Name": "Ec2Instance",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "Ec2Resource"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              },
              {
                "Key": "actionOnTaskFailure",
                "StringValue": "terminate"
              },
              {
                "Key": "terminateAfter",
                "StringValue": "2 Hours"
              },
              {
                "Key": "subnetId",
                "StringValue": "#{myEc2InstanceSubnet}"
              },
              {
                "Key": "securityGroupIds",
                "StringValue": "#{myRDSRedshiftSecurityGrps}"
              }
            ]
          },
          {
            "Id": "RDSDatabase",
            "Name": "RDSDatabase",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "JdbcDatabase"
              },
              {
                "Key": "jdbcProperties",
                "StringValue": "allowMultiQueries=true"
              },
              {
                "Key": "jdbcDriverClass",
                "StringValue": "com.mysql.jdbc.Driver"
              },
              {
                "Key": "connectionString",
                "StringValue": "#{myRDSJdbcConnectStr}"
              },
              {
                "Key": "username",
                "StringValue": "#{myRDSUsername}"
              },
              {
                "Key": "*password",
                "StringValue": "#{*myRDSPassword}"
              }
            ]
          },
          {
            "Id": "RedshiftCluster",
            "Name": "RedshiftCluster",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftDatabase"
              },
              {
                "Key": "connectionString",
                "StringValue": "#{myRedshiftJdbcConnectStr}"
              },
              {
                "Key": "*password",
                "StringValue": "#{*myRedshiftPassword}"
              },
              {
                "Key": "username",
                "StringValue": "#{myRedshiftUsername}"
              }
            ]
          },

          {
            "Id": "RDSScripts",
            "Name": "RDSScripts",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "SqlDataNode"
              },
              {
                "Key": "database",
                "RefValue": "RDSDatabase"
              },
              {
                "Key": "table",
                "StringValue": "scripts"
              },
              {
                "Key": "selectQuery",
                "StringValue": "select * from scripts where #{myRDSTableLastModifiedCol} >= '#{format(@scheduledStartTime, 'YYYY-MM-dd HH-mm-ss')}' and #{myRDSTableLastModifiedCol} <= '#{format(@scheduledEndTime, 'YYYY-MM-dd HH-mm-ss')}'"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3Scripts",
            "Name": "S3Scripts",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "S3DataNode"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              },
              {
                "Key": "directoryPath",
                "StringValue": "#{myS3StagingLoc}/#{format(@scheduledStartTime, 'YYYY-MM-dd-HH-mm-ss')}/scripts"
              }
            ]
          },
          {
            "Id": "RedshiftScripts",
            "Name": "RedshiftScripts",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftDataNode"
              },
              {
                "Key": "database",
                "RefValue": "RedshiftCluster"
              },
              {
                "Key": "tableName",
                "StringValue": "scripts"
              },
              {
                "Key": "schemaName",
                "StringValue": "dashboard"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RedshiftCreateScripts",
            "Name": "RedshiftCreateScripts",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "ShellCommandActivity"
              },
              {
                "Key": "input",
                "RefValue": "RDSScripts"
              },
              {
                "Key": "output",
                "RefValue": "RedshiftScripts"
              },
              {
                "Key": "scriptUri",
                "StringValue": "s3://cdo-dist/dbconv.sh"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_jdbc=#{myRDSJdbcConnectStr}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_tbl=scripts"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_pwd=#{*myRDSPassword}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_usr=#{myRDSUsername}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_jdbc=#{myRedshiftJdbcConnectStr}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_usr=#{myRedshiftUsername}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_pwd=#{*myRedshiftPassword}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_tbl=dashboard.scripts"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_dist=#{myRedshiftDistributionKey}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_sort=#{myRedshiftSortKeys}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_map=#{myRedshiftTypeConvOverrideMap}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_ins=#{myInsertMode}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_cols="
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RDSToS3Scripts",
            "Name": "RDSToS3Scripts",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "CopyActivity"
              },
              {
                "Key": "input",
                "RefValue": "RDSScripts"
              },
              {
                "Key": "output",
                "RefValue": "S3Scripts"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3ToRedshiftScripts",
            "Name": "S3ToRedshiftScripts",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftCopyActivity"
              },
              {
                "Key": "dependsOn",
                "RefValue": "RedshiftCreateScripts"
              },
              {
                "Key": "dependsOn",
                "RefValue": "RDSToS3Scripts"
              },
              {
                "Key": "input",
                "RefValue": "S3Scripts"
              },
              {
                "Key": "output",
                "RefValue": "RedshiftScripts"
              },
              {
                "Key": "insertMode",
                "StringValue": "#{myInsertMode}"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },

          {
            "Id": "RDSFollowers",
            "Name": "RDSFollowers",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "SqlDataNode"
              },
              {
                "Key": "database",
                "RefValue": "RDSDatabase"
              },
              {
                "Key": "table",
                "StringValue": "followers"
              },
              {
                "Key": "selectQuery",
                "StringValue": "select * from followers where #{myRDSTableLastModifiedCol} >= '#{format(@scheduledStartTime, 'YYYY-MM-dd HH-mm-ss')}' and #{myRDSTableLastModifiedCol} <= '#{format(@scheduledEndTime, 'YYYY-MM-dd HH-mm-ss')}'"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3Followers",
            "Name": "S3Followers",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "S3DataNode"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              },
              {
                "Key": "directoryPath",
                "StringValue": "#{myS3StagingLoc}/#{format(@scheduledStartTime, 'YYYY-MM-dd-HH-mm-ss')}/followers"
              }
            ]
          },
          {
            "Id": "RedshiftFollowers",
            "Name": "RedshiftFollowers",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftDataNode"
              },
              {
                "Key": "database",
                "RefValue": "RedshiftCluster"
              },
              {
                "Key": "tableName",
                "StringValue": "followers"
              },
              {
                "Key": "schemaName",
                "StringValue": "dashboard"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RedshiftCreateFollowers",
            "Name": "RedshiftCreateFollowers",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "ShellCommandActivity"
              },
              {
                "Key": "input",
                "RefValue": "RDSFollowers"
              },
              {
                "Key": "output",
                "RefValue": "RedshiftFollowers"
              },
              {
                "Key": "scriptUri",
                "StringValue": "s3://cdo-dist/dbconv.sh"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_jdbc=#{myRDSJdbcConnectStr}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_tbl=followers"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_pwd=#{*myRDSPassword}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_usr=#{myRDSUsername}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_jdbc=#{myRedshiftJdbcConnectStr}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_usr=#{myRedshiftUsername}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_pwd=#{*myRedshiftPassword}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_tbl=dashboard.followers"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_dist=#{myRedshiftDistributionKey}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_sort=#{myRedshiftSortKeys}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_map=#{myRedshiftTypeConvOverrideMap}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_ins=#{myInsertMode}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_cols="
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RDSToS3Followers",
            "Name": "RDSToS3Followers",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "CopyActivity"
              },
              {
                "Key": "input",
                "RefValue": "RDSFollowers"
              },
              {
                "Key": "output",
                "RefValue": "S3Followers"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3ToRedshiftFollowers",
            "Name": "S3ToRedshiftFollowers",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftCopyActivity"
              },
              {
                "Key": "dependsOn",
                "RefValue": "RedshiftCreateFollowers"
              },
              {
                "Key": "dependsOn",
                "RefValue": "RDSToS3Followers"
              },
              {
                "Key": "input",
                "RefValue": "S3Followers"
              },
              {
                "Key": "output",
                "RefValue": "RedshiftFollowers"
              },
              {
                "Key": "insertMode",
                "StringValue": "#{myInsertMode}"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RDSStages",
            "Name": "RDSStages",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "SqlDataNode"
              },
              {
                "Key": "database",
                "RefValue": "RDSDatabase"
              },
              {
                "Key": "table",
                "StringValue": "stages"
              },
              {
                "Key": "selectQuery",
                "StringValue": "select * from stages where #{myRDSTableLastModifiedCol} >= '#{format(@scheduledStartTime, 'YYYY-MM-dd HH-mm-ss')}' and #{myRDSTableLastModifiedCol} <= '#{format(@scheduledEndTime, 'YYYY-MM-dd HH-mm-ss')}'"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3Stages",
            "Name": "S3Stages",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "S3DataNode"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              },
              {
                "Key": "directoryPath",
                "StringValue": "#{myS3StagingLoc}/#{format(@scheduledStartTime, 'YYYY-MM-dd-HH-mm-ss')}/stages"
              }
            ]
          },
          {
            "Id": "RedshiftStages",
            "Name": "RedshiftStages",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftDataNode"
              },
              {
                "Key": "database",
                "RefValue": "RedshiftCluster"
              },
              {
                "Key": "tableName",
                "StringValue": "stages"
              },
              {
                "Key": "schemaName",
                "StringValue": "dashboard"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RedshiftCreateStages",
            "Name": "RedshiftCreateStages",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "ShellCommandActivity"
              },
              {
                "Key": "input",
                "RefValue": "RDSStages"
              },
              {
                "Key": "output",
                "RefValue": "RedshiftStages"
              },
              {
                "Key": "scriptUri",
                "StringValue": "s3://cdo-dist/dbconv.sh"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_jdbc=#{myRDSJdbcConnectStr}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_tbl=stages"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_pwd=#{*myRDSPassword}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_usr=#{myRDSUsername}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_jdbc=#{myRedshiftJdbcConnectStr}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_usr=#{myRedshiftUsername}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_pwd=#{*myRedshiftPassword}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_tbl=dashboard.stages"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_dist=#{myRedshiftDistributionKey}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_sort=#{myRedshiftSortKeys}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_map=#{myRedshiftTypeConvOverrideMap}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_ins=#{myInsertMode}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_cols="
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RDSToS3Stages",
            "Name": "RDSToS3Stages",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "CopyActivity"
              },
              {
                "Key": "input",
                "RefValue": "RDSStages"
              },
              {
                "Key": "output",
                "RefValue": "S3Stages"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3ToRedshiftStages",
            "Name": "S3ToRedshiftStages",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftCopyActivity"
              },
              {
                "Key": "dependsOn",
                "RefValue": "RedshiftCreateStages"
              },
              {
                "Key": "dependsOn",
                "RefValue": "RDSToS3Stages"
              },
              {
                "Key": "input",
                "RefValue": "S3Stages"
              },
              {
                "Key": "output",
                "RefValue": "RedshiftStages"
              },
              {
                "Key": "insertMode",
                "StringValue": "#{myInsertMode}"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RDSScriptLevels",
            "Name": "RDSScriptLevels",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "SqlDataNode"
              },
              {
                "Key": "database",
                "RefValue": "RDSDatabase"
              },
              {
                "Key": "table",
                "StringValue": "script_levels"
              },
              {
                "Key": "selectQuery",
                "StringValue": "select * from script_levels where #{myRDSTableLastModifiedCol} >= '#{format(@scheduledStartTime, 'YYYY-MM-dd HH-mm-ss')}' and #{myRDSTableLastModifiedCol} <= '#{format(@scheduledEndTime, 'YYYY-MM-dd HH-mm-ss')}'"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3ScriptLevels",
            "Name": "S3ScriptLevels",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "S3DataNode"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              },
              {
                "Key": "directoryPath",
                "StringValue": "#{myS3StagingLoc}/#{format(@scheduledStartTime, 'YYYY-MM-dd-HH-mm-ss')}/script_levels"
              }
            ]
          },
          {
            "Id": "RedshiftScriptLevels",
            "Name": "RedshiftScriptLevels",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftDataNode"
              },
              {
                "Key": "database",
                "RefValue": "RedshiftCluster"
              },
              {
                "Key": "tableName",
                "StringValue": "script_levels"
              },
              {
                "Key": "schemaName",
                "StringValue": "dashboard"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RedshiftCreateScriptLevels",
            "Name": "RedshiftCreateScriptLevels",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "ShellCommandActivity"
              },
              {
                "Key": "input",
                "RefValue": "RDSScriptLevels"
              },
              {
                "Key": "output",
                "RefValue": "RedshiftScriptLevels"
              },
              {
                "Key": "scriptUri",
                "StringValue": "s3://cdo-dist/dbconv.sh"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_jdbc=#{myRDSJdbcConnectStr}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_tbl=script_levels"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_pwd=#{*myRDSPassword}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_usr=#{myRDSUsername}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_jdbc=#{myRedshiftJdbcConnectStr}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_usr=#{myRedshiftUsername}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_pwd=#{*myRedshiftPassword}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_tbl=dashboard.script_levels"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_dist=#{myRedshiftDistributionKey}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_sort=#{myRedshiftSortKeys}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_map=#{myRedshiftTypeConvOverrideMap}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_ins=#{myInsertMode}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_cols="
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RDSToS3ScriptLevels",
            "Name": "RDSToS3ScriptLevels",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "CopyActivity"
              },
              {
                "Key": "input",
                "RefValue": "RDSScriptLevels"
              },
              {
                "Key": "output",
                "RefValue": "S3ScriptLevels"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3ToRedshiftScriptLevels",
            "Name": "S3ToRedshiftScriptLevels",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftCopyActivity"
              },
              {
                "Key": "dependsOn",
                "RefValue": "RedshiftCreateScriptLevels"
              },
              {
                "Key": "dependsOn",
                "RefValue": "RDSToS3ScriptLevels"
              },
              {
                "Key": "input",
                "RefValue": "S3ScriptLevels"
              },
              {
                "Key": "output",
                "RefValue": "RedshiftScriptLevels"
              },
              {
                "Key": "insertMode",
                "StringValue": "#{myInsertMode}"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RDSWorkshops",
            "Name": "RDSWorkshops",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "SqlDataNode"
              },
              {
                "Key": "database",
                "RefValue": "RDSDatabase"
              },
              {
                "Key": "table",
                "StringValue": "workshops"
              },
              {
                "Key": "selectQuery",
                "StringValue": "select * from workshops where #{myRDSTableLastModifiedCol} >= '#{format(@scheduledStartTime, 'YYYY-MM-dd HH-mm-ss')}' and #{myRDSTableLastModifiedCol} <= '#{format(@scheduledEndTime, 'YYYY-MM-dd HH-mm-ss')}'"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3Workshops",
            "Name": "S3Workshops",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "S3DataNode"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              },
              {
                "Key": "directoryPath",
                "StringValue": "#{myS3StagingLoc}/#{format(@scheduledStartTime, 'YYYY-MM-dd-HH-mm-ss')}/workshops"
              }
            ]
          },
          {
            "Id": "RedshiftWorkshops",
            "Name": "RedshiftWorkshops",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftDataNode"
              },
              {
                "Key": "database",
                "RefValue": "RedshiftCluster"
              },
              {
                "Key": "tableName",
                "StringValue": "workshops"
              },
              {
                "Key": "schemaName",
                "StringValue": "dashboard"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RedshiftCreateWorkshops",
            "Name": "RedshiftCreateWorkshops",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "ShellCommandActivity"
              },
              {
                "Key": "input",
                "RefValue": "RDSWorkshops"
              },
              {
                "Key": "output",
                "RefValue": "RedshiftWorkshops"
              },
              {
                "Key": "scriptUri",
                "StringValue": "s3://cdo-dist/dbconv.sh"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_jdbc=#{myRDSJdbcConnectStr}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_tbl=workshops"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_pwd=#{*myRDSPassword}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_usr=#{myRDSUsername}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_jdbc=#{myRedshiftJdbcConnectStr}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_usr=#{myRedshiftUsername}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_pwd=#{*myRedshiftPassword}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_tbl=dashboard.workshops"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_dist=#{myRedshiftDistributionKey}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_sort=#{myRedshiftSortKeys}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_map=#{myRedshiftTypeConvOverrideMap}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_ins=#{myInsertMode}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_cols="
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RDSToS3Workshops",
            "Name": "RDSToS3Workshops",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "CopyActivity"
              },
              {
                "Key": "input",
                "RefValue": "RDSWorkshops"
              },
              {
                "Key": "output",
                "RefValue": "S3Workshops"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3ToRedshiftWorkshops",
            "Name": "S3ToRedshiftWorkshops",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftCopyActivity"
              },
              {
                "Key": "dependsOn",
                "RefValue": "RedshiftCreateWorkshops"
              },
              {
                "Key": "dependsOn",
                "RefValue": "RDSToS3Workshops"
              },
              {
                "Key": "input",
                "RefValue": "S3Workshops"
              },
              {
                "Key": "output",
                "RefValue": "RedshiftWorkshops"
              },
              {
                "Key": "insertMode",
                "StringValue": "#{myInsertMode}"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RDSSegments",
            "Name": "RDSSegments",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "SqlDataNode"
              },
              {
                "Key": "database",
                "RefValue": "RDSDatabase"
              },
              {
                "Key": "table",
                "StringValue": "segments"
              },
              {
                "Key": "selectQuery",
                "StringValue": "select * from segments where #{myRDSTableLastModifiedCol} >= '#{format(@scheduledStartTime, 'YYYY-MM-dd HH-mm-ss')}' and #{myRDSTableLastModifiedCol} <= '#{format(@scheduledEndTime, 'YYYY-MM-dd HH-mm-ss')}'"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3Segments",
            "Name": "S3Segments",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "S3DataNode"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              },
              {
                "Key": "directoryPath",
                "StringValue": "#{myS3StagingLoc}/#{format(@scheduledStartTime, 'YYYY-MM-dd-HH-mm-ss')}/segments"
              }
            ]
          },
          {
            "Id": "RedshiftSegments",
            "Name": "RedshiftSegments",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftDataNode"
              },
              {
                "Key": "database",
                "RefValue": "RedshiftCluster"
              },
              {
                "Key": "tableName",
                "StringValue": "segments"
              },
              {
                "Key": "schemaName",
                "StringValue": "dashboard"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RedshiftCreateSegments",
            "Name": "RedshiftCreateSegments",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "ShellCommandActivity"
              },
              {
                "Key": "input",
                "RefValue": "RDSSegments"
              },
              {
                "Key": "output",
                "RefValue": "RedshiftSegments"
              },
              {
                "Key": "scriptUri",
                "StringValue": "s3://cdo-dist/dbconv.sh"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_jdbc=#{myRDSJdbcConnectStr}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_tbl=segments"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_pwd=#{*myRDSPassword}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_usr=#{myRDSUsername}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_jdbc=#{myRedshiftJdbcConnectStr}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_usr=#{myRedshiftUsername}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_pwd=#{*myRedshiftPassword}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_tbl=dashboard.segments"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_dist=#{myRedshiftDistributionKey}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_sort=#{myRedshiftSortKeys}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_map=#{myRedshiftTypeConvOverrideMap}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_ins=#{myInsertMode}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_cols="
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RDSToS3Segments",
            "Name": "RDSToS3Segments",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "CopyActivity"
              },
              {
                "Key": "input",
                "RefValue": "RDSSegments"
              },
              {
                "Key": "output",
                "RefValue": "S3Segments"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3ToRedshiftSegments",
            "Name": "S3ToRedshiftSegments",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftCopyActivity"
              },
              {
                "Key": "dependsOn",
                "RefValue": "RedshiftCreateSegments"
              },
              {
                "Key": "dependsOn",
                "RefValue": "RDSToS3Segments"
              },
              {
                "Key": "input",
                "RefValue": "S3Segments"
              },
              {
                "Key": "output",
                "RefValue": "RedshiftSegments"
              },
              {
                "Key": "insertMode",
                "StringValue": "#{myInsertMode}"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RDSPuzzleRatings",
            "Name": "RDSPuzzleRatings",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "SqlDataNode"
              },
              {
                "Key": "database",
                "RefValue": "RDSDatabase"
              },
              {
                "Key": "table",
                "StringValue": "puzzle_ratings"
              },
              {
                "Key": "selectQuery",
                "StringValue": "select * from puzzle_ratings where #{myRDSTableLastModifiedCol} >= '#{format(@scheduledStartTime, 'YYYY-MM-dd HH-mm-ss')}' and #{myRDSTableLastModifiedCol} <= '#{format(@scheduledEndTime, 'YYYY-MM-dd HH-mm-ss')}'"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3PuzzleRatings",
            "Name": "S3PuzzleRatings",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "S3DataNode"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              },
              {
                "Key": "directoryPath",
                "StringValue": "#{myS3StagingLoc}/#{format(@scheduledStartTime, 'YYYY-MM-dd-HH-mm-ss')}/puzzle_ratings"
              }
            ]
          },
          {
            "Id": "RedshiftPuzzleRatings",
            "Name": "RedshiftPuzzleRatings",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftDataNode"
              },
              {
                "Key": "database",
                "RefValue": "RedshiftCluster"
              },
              {
                "Key": "tableName",
                "StringValue": "puzzle_ratings"
              },
              {
                "Key": "schemaName",
                "StringValue": "dashboard"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RedshiftCreatePuzzleRatings",
            "Name": "RedshiftCreatePuzzleRatings",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "ShellCommandActivity"
              },
              {
                "Key": "input",
                "RefValue": "RDSPuzzleRatings"
              },
              {
                "Key": "output",
                "RefValue": "RedshiftPuzzleRatings"
              },
              {
                "Key": "scriptUri",
                "StringValue": "s3://cdo-dist/dbconv.sh"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_jdbc=#{myRDSJdbcConnectStr}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_tbl=puzzle_ratings"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_pwd=#{*myRDSPassword}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_usr=#{myRDSUsername}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_jdbc=#{myRedshiftJdbcConnectStr}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_usr=#{myRedshiftUsername}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_pwd=#{*myRedshiftPassword}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_tbl=dashboard.puzzle_ratings"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_dist=#{myRedshiftDistributionKey}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_sort=#{myRedshiftSortKeys}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_map=#{myRedshiftTypeConvOverrideMap}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_ins=#{myInsertMode}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_cols="
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RDSToS3PuzzleRatings",
            "Name": "RDSToS3PuzzleRatings",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "CopyActivity"
              },
              {
                "Key": "input",
                "RefValue": "RDSPuzzleRatings"
              },
              {
                "Key": "output",
                "RefValue": "S3PuzzleRatings"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3ToRedshiftPuzzleRatings",
            "Name": "S3ToRedshiftPuzzleRatings",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftCopyActivity"
              },
              {
                "Key": "dependsOn",
                "RefValue": "RedshiftCreatePuzzleRatings"
              },
              {
                "Key": "dependsOn",
                "RefValue": "RDSToS3PuzzleRatings"
              },
              {
                "Key": "input",
                "RefValue": "S3PuzzleRatings"
              },
              {
                "Key": "output",
                "RefValue": "RedshiftPuzzleRatings"
              },
              {
                "Key": "insertMode",
                "StringValue": "#{myInsertMode}"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RDSUserScripts",
            "Name": "RDSUserScripts",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "SqlDataNode"
              },
              {
                "Key": "database",
                "RefValue": "RDSDatabase"
              },
              {
                "Key": "table",
                "StringValue": "user_scripts"
              },
              {
                "Key": "selectQuery",
                "StringValue": "select * from user_scripts where #{myRDSTableLastModifiedCol} >= '#{format(@scheduledStartTime, 'YYYY-MM-dd HH-mm-ss')}' and #{myRDSTableLastModifiedCol} <= '#{format(@scheduledEndTime, 'YYYY-MM-dd HH-mm-ss')}'"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3UserScripts",
            "Name": "S3UserScripts",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "S3DataNode"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              },
              {
                "Key": "directoryPath",
                "StringValue": "#{myS3StagingLoc}/#{format(@scheduledStartTime, 'YYYY-MM-dd-HH-mm-ss')}/user_scripts"
              }
            ]
          },
          {
            "Id": "RedshiftUserScripts",
            "Name": "RedshiftUserScripts",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftDataNode"
              },
              {
                "Key": "database",
                "RefValue": "RedshiftCluster"
              },
              {
                "Key": "tableName",
                "StringValue": "user_scripts"
              },
              {
                "Key": "schemaName",
                "StringValue": "dashboard"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RedshiftCreateUserScripts",
            "Name": "RedshiftCreateUserScripts",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "ShellCommandActivity"
              },
              {
                "Key": "input",
                "RefValue": "RDSUserScripts"
              },
              {
                "Key": "output",
                "RefValue": "RedshiftUserScripts"
              },
              {
                "Key": "scriptUri",
                "StringValue": "s3://cdo-dist/dbconv.sh"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_jdbc=#{myRDSJdbcConnectStr}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_tbl=user_scripts"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_pwd=#{*myRDSPassword}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_usr=#{myRDSUsername}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_jdbc=#{myRedshiftJdbcConnectStr}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_usr=#{myRedshiftUsername}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_pwd=#{*myRedshiftPassword}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_tbl=dashboard.user_scripts"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_dist=#{myRedshiftDistributionKey}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_sort=#{myRedshiftSortKeys}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_map=#{myRedshiftTypeConvOverrideMap}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_ins=#{myInsertMode}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_cols="
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RDSToS3UserScripts",
            "Name": "RDSToS3UserScripts",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "CopyActivity"
              },
              {
                "Key": "input",
                "RefValue": "RDSUserScripts"
              },
              {
                "Key": "output",
                "RefValue": "S3UserScripts"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3ToRedshiftUserScripts",
            "Name": "S3ToRedshiftUserScripts",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftCopyActivity"
              },
              {
                "Key": "dependsOn",
                "RefValue": "RedshiftCreateUserScripts"
              },
              {
                "Key": "dependsOn",
                "RefValue": "RDSToS3UserScripts"
              },
              {
                "Key": "input",
                "RefValue": "S3UserScripts"
              },
              {
                "Key": "output",
                "RefValue": "RedshiftUserScripts"
              },
              {
                "Key": "insertMode",
                "StringValue": "#{myInsertMode}"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RDSChannelTokens",
            "Name": "RDSChannelTokens",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "SqlDataNode"
              },
              {
                "Key": "database",
                "RefValue": "RDSDatabase"
              },
              {
                "Key": "table",
                "StringValue": "channel_tokens"
              },
              {
                "Key": "selectQuery",
                "StringValue": "select * from channel_tokens where #{myRDSTableLastModifiedCol} >= '#{format(@scheduledStartTime, 'YYYY-MM-dd HH-mm-ss')}' and #{myRDSTableLastModifiedCol} <= '#{format(@scheduledEndTime, 'YYYY-MM-dd HH-mm-ss')}'"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3ChannelTokens",
            "Name": "S3ChannelTokens",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "S3DataNode"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              },
              {
                "Key": "directoryPath",
                "StringValue": "#{myS3StagingLoc}/#{format(@scheduledStartTime, 'YYYY-MM-dd-HH-mm-ss')}/channel_tokens"
              }
            ]
          },
          {
            "Id": "RedshiftChannelTokens",
            "Name": "RedshiftChannelTokens",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftDataNode"
              },
              {
                "Key": "database",
                "RefValue": "RedshiftCluster"
              },
              {
                "Key": "tableName",
                "StringValue": "channel_tokens"
              },
              {
                "Key": "schemaName",
                "StringValue": "dashboard"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RedshiftCreateChannelTokens",
            "Name": "RedshiftCreateChannelTokens",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "ShellCommandActivity"
              },
              {
                "Key": "input",
                "RefValue": "RDSChannelTokens"
              },
              {
                "Key": "output",
                "RefValue": "RedshiftChannelTokens"
              },
              {
                "Key": "scriptUri",
                "StringValue": "s3://cdo-dist/dbconv.sh"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_jdbc=#{myRDSJdbcConnectStr}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_tbl=channel_tokens"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_pwd=#{*myRDSPassword}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_usr=#{myRDSUsername}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_jdbc=#{myRedshiftJdbcConnectStr}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_usr=#{myRedshiftUsername}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_pwd=#{*myRedshiftPassword}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_tbl=dashboard.channel_tokens"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_dist=#{myRedshiftDistributionKey}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_sort=#{myRedshiftSortKeys}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_map=#{myRedshiftTypeConvOverrideMap}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_ins=#{myInsertMode}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_cols="
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RDSToS3ChannelTokens",
            "Name": "RDSToS3ChannelTokens",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "CopyActivity"
              },
              {
                "Key": "input",
                "RefValue": "RDSChannelTokens"
              },
              {
                "Key": "output",
                "RefValue": "S3ChannelTokens"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3ToRedshiftChannelTokens",
            "Name": "S3ToRedshiftChannelTokens",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftCopyActivity"
              },
              {
                "Key": "dependsOn",
                "RefValue": "RedshiftCreateChannelTokens"
              },
              {
                "Key": "dependsOn",
                "RefValue": "RDSToS3ChannelTokens"
              },
              {
                "Key": "input",
                "RefValue": "S3ChannelTokens"
              },
              {
                "Key": "output",
                "RefValue": "RedshiftChannelTokens"
              },
              {
                "Key": "insertMode",
                "StringValue": "#{myInsertMode}"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RDSLevels",
            "Name": "RDSLevels",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "SqlDataNode"
              },
              {
                "Key": "database",
                "RefValue": "RDSDatabase"
              },
              {
                "Key": "table",
                "StringValue": "levels"
              },
              {
                "Key": "selectQuery",
                "StringValue": "select * from levels where #{myRDSTableLastModifiedCol} >= '#{format(@scheduledStartTime, 'YYYY-MM-dd HH-mm-ss')}' and #{myRDSTableLastModifiedCol} <= '#{format(@scheduledEndTime, 'YYYY-MM-dd HH-mm-ss')}'"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3Levels",
            "Name": "S3Levels",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "S3DataNode"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              },
              {
                "Key": "directoryPath",
                "StringValue": "#{myS3StagingLoc}/#{format(@scheduledStartTime, 'YYYY-MM-dd-HH-mm-ss')}/levels"
              }
            ]
          },
          {
            "Id": "RedshiftLevels",
            "Name": "RedshiftLevels",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftDataNode"
              },
              {
                "Key": "database",
                "RefValue": "RedshiftCluster"
              },
              {
                "Key": "tableName",
                "StringValue": "levels"
              },
              {
                "Key": "schemaName",
                "StringValue": "dashboard"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RedshiftCreateLevels",
            "Name": "RedshiftCreateLevels",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "ShellCommandActivity"
              },
              {
                "Key": "input",
                "RefValue": "RDSLevels"
              },
              {
                "Key": "output",
                "RefValue": "RedshiftLevels"
              },
              {
                "Key": "scriptUri",
                "StringValue": "s3://cdo-dist/dbconv.sh"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_jdbc=#{myRDSJdbcConnectStr}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_tbl=levels"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_pwd=#{*myRDSPassword}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_usr=#{myRDSUsername}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_jdbc=#{myRedshiftJdbcConnectStr}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_usr=#{myRedshiftUsername}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_pwd=#{*myRedshiftPassword}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_tbl=dashboard.levels"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_dist=#{myRedshiftDistributionKey}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_sort=#{myRedshiftSortKeys}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_map=#{myRedshiftTypeConvOverrideMap}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_ins=#{myInsertMode}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_cols="
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RDSToS3Levels",
            "Name": "RDSToS3Levels",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "CopyActivity"
              },
              {
                "Key": "input",
                "RefValue": "RDSLevels"
              },
              {
                "Key": "output",
                "RefValue": "S3Levels"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3ToRedshiftLevels",
            "Name": "S3ToRedshiftLevels",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftCopyActivity"
              },
              {
                "Key": "dependsOn",
                "RefValue": "RedshiftCreateLevels"
              },
              {
                "Key": "dependsOn",
                "RefValue": "RDSToS3Levels"
              },
              {
                "Key": "input",
                "RefValue": "S3Levels"
              },
              {
                "Key": "output",
                "RefValue": "RedshiftLevels"
              },
              {
                "Key": "insertMode",
                "StringValue": "#{myInsertMode}"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RDSUserProficiencies",
            "Name": "RDSUserProficiencies",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "SqlDataNode"
              },
              {
                "Key": "database",
                "RefValue": "RDSDatabase"
              },
              {
                "Key": "table",
                "StringValue": "user_proficiencies"
              },
              {
                "Key": "selectQuery",
                "StringValue": "select * from user_proficiencies where #{myRDSTableLastModifiedCol} >= '#{format(@scheduledStartTime, 'YYYY-MM-dd HH-mm-ss')}' and #{myRDSTableLastModifiedCol} <= '#{format(@scheduledEndTime, 'YYYY-MM-dd HH-mm-ss')}'"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3UserProficiencies",
            "Name": "S3UserProficiencies",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "S3DataNode"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              },
              {
                "Key": "directoryPath",
                "StringValue": "#{myS3StagingLoc}/#{format(@scheduledStartTime, 'YYYY-MM-dd-HH-mm-ss')}/user_proficiencies"
              }
            ]
          },
          {
            "Id": "RedshiftUserProficiencies",
            "Name": "RedshiftUserProficiencies",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftDataNode"
              },
              {
                "Key": "database",
                "RefValue": "RedshiftCluster"
              },
              {
                "Key": "tableName",
                "StringValue": "user_proficiencies"
              },
              {
                "Key": "schemaName",
                "StringValue": "dashboard"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RedshiftCreateUserProficiencies",
            "Name": "RedshiftCreateUserProficiencies",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "ShellCommandActivity"
              },
              {
                "Key": "input",
                "RefValue": "RDSUserProficiencies"
              },
              {
                "Key": "output",
                "RefValue": "RedshiftUserProficiencies"
              },
              {
                "Key": "scriptUri",
                "StringValue": "s3://cdo-dist/dbconv.sh"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_jdbc=#{myRDSJdbcConnectStr}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_tbl=user_proficiencies"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_pwd=#{*myRDSPassword}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_usr=#{myRDSUsername}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_jdbc=#{myRedshiftJdbcConnectStr}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_usr=#{myRedshiftUsername}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_pwd=#{*myRedshiftPassword}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_tbl=dashboard.user_proficiencies"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_dist=#{myRedshiftDistributionKey}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_sort=#{myRedshiftSortKeys}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_map=#{myRedshiftTypeConvOverrideMap}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_ins=#{myInsertMode}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_cols="
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RDSToS3UserProficiencies",
            "Name": "RDSToS3UserProficiencies",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "CopyActivity"
              },
              {
                "Key": "input",
                "RefValue": "RDSUserProficiencies"
              },
              {
                "Key": "output",
                "RefValue": "S3UserProficiencies"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3ToRedshiftUserProficiencies",
            "Name": "S3ToRedshiftUserProficiencies",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftCopyActivity"
              },
              {
                "Key": "dependsOn",
                "RefValue": "RedshiftCreateUserProficiencies"
              },
              {
                "Key": "dependsOn",
                "RefValue": "RDSToS3UserProficiencies"
              },
              {
                "Key": "input",
                "RefValue": "S3UserProficiencies"
              },
              {
                "Key": "output",
                "RefValue": "RedshiftUserProficiencies"
              },
              {
                "Key": "insertMode",
                "StringValue": "#{myInsertMode}"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RDSWorkshopAttendance",
            "Name": "RDSWorkshopAttendance",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "SqlDataNode"
              },
              {
                "Key": "database",
                "RefValue": "RDSDatabase"
              },
              {
                "Key": "table",
                "StringValue": "workshop_attendance"
              },
              {
                "Key": "selectQuery",
                "StringValue": "select * from workshop_attendance where #{myRDSTableLastModifiedCol} >= '#{format(@scheduledStartTime, 'YYYY-MM-dd HH-mm-ss')}' and #{myRDSTableLastModifiedCol} <= '#{format(@scheduledEndTime, 'YYYY-MM-dd HH-mm-ss')}'"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3WorkshopAttendance",
            "Name": "S3WorkshopAttendance",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "S3DataNode"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              },
              {
                "Key": "directoryPath",
                "StringValue": "#{myS3StagingLoc}/#{format(@scheduledStartTime, 'YYYY-MM-dd-HH-mm-ss')}/workshop_attendance"
              }
            ]
          },
          {
            "Id": "RedshiftWorkshopAttendance",
            "Name": "RedshiftWorkshopAttendance",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftDataNode"
              },
              {
                "Key": "database",
                "RefValue": "RedshiftCluster"
              },
              {
                "Key": "tableName",
                "StringValue": "workshop_attendance"
              },
              {
                "Key": "schemaName",
                "StringValue": "dashboard"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RedshiftCreateWorkshopAttendance",
            "Name": "RedshiftCreateWorkshopAttendance",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "ShellCommandActivity"
              },
              {
                "Key": "input",
                "RefValue": "RDSWorkshopAttendance"
              },
              {
                "Key": "output",
                "RefValue": "RedshiftWorkshopAttendance"
              },
              {
                "Key": "scriptUri",
                "StringValue": "s3://cdo-dist/dbconv.sh"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_jdbc=#{myRDSJdbcConnectStr}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_tbl=workshop_attendance"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_pwd=#{*myRDSPassword}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_usr=#{myRDSUsername}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_jdbc=#{myRedshiftJdbcConnectStr}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_usr=#{myRedshiftUsername}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_pwd=#{*myRedshiftPassword}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_tbl=dashboard.workshop_attendance"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_dist=#{myRedshiftDistributionKey}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_sort=#{myRedshiftSortKeys}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_map=#{myRedshiftTypeConvOverrideMap}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_ins=#{myInsertMode}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_cols="
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RDSToS3WorkshopAttendance",
            "Name": "RDSToS3WorkshopAttendance",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "CopyActivity"
              },
              {
                "Key": "input",
                "RefValue": "RDSWorkshopAttendance"
              },
              {
                "Key": "output",
                "RefValue": "S3WorkshopAttendance"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3ToRedshiftWorkshopAttendance",
            "Name": "S3ToRedshiftWorkshopAttendance",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftCopyActivity"
              },
              {
                "Key": "dependsOn",
                "RefValue": "RedshiftCreateWorkshopAttendance"
              },
              {
                "Key": "dependsOn",
                "RefValue": "RDSToS3WorkshopAttendance"
              },
              {
                "Key": "input",
                "RefValue": "S3WorkshopAttendance"
              },
              {
                "Key": "output",
                "RefValue": "RedshiftWorkshopAttendance"
              },
              {
                "Key": "insertMode",
                "StringValue": "#{myInsertMode}"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RDSHintViewRequests",
            "Name": "RDSHintViewRequests",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "SqlDataNode"
              },
              {
                "Key": "database",
                "RefValue": "RDSDatabase"
              },
              {
                "Key": "table",
                "StringValue": "hint_view_requests"
              },
              {
                "Key": "selectQuery",
                "StringValue": "select * from hint_view_requests where #{myRDSTableLastModifiedCol} >= '#{format(@scheduledStartTime, 'YYYY-MM-dd HH-mm-ss')}' and #{myRDSTableLastModifiedCol} <= '#{format(@scheduledEndTime, 'YYYY-MM-dd HH-mm-ss')}'"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3HintViewRequests",
            "Name": "S3HintViewRequests",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "S3DataNode"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              },
              {
                "Key": "directoryPath",
                "StringValue": "#{myS3StagingLoc}/#{format(@scheduledStartTime, 'YYYY-MM-dd-HH-mm-ss')}/hint_view_requests"
              }
            ]
          },
          {
            "Id": "RedshiftHintViewRequests",
            "Name": "RedshiftHintViewRequests",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftDataNode"
              },
              {
                "Key": "database",
                "RefValue": "RedshiftCluster"
              },
              {
                "Key": "tableName",
                "StringValue": "hint_view_requests"
              },
              {
                "Key": "schemaName",
                "StringValue": "dashboard"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RedshiftCreateHintViewRequests",
            "Name": "RedshiftCreateHintViewRequests",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "ShellCommandActivity"
              },
              {
                "Key": "input",
                "RefValue": "RDSHintViewRequests"
              },
              {
                "Key": "output",
                "RefValue": "RedshiftHintViewRequests"
              },
              {
                "Key": "scriptUri",
                "StringValue": "s3://cdo-dist/dbconv.sh"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_jdbc=#{myRDSJdbcConnectStr}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_tbl=hint_view_requests"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_pwd=#{*myRDSPassword}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_usr=#{myRDSUsername}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_jdbc=#{myRedshiftJdbcConnectStr}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_usr=#{myRedshiftUsername}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_pwd=#{*myRedshiftPassword}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_tbl=dashboard.hint_view_requests"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_dist=#{myRedshiftDistributionKey}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_sort=#{myRedshiftSortKeys}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_map=#{myRedshiftTypeConvOverrideMap}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_ins=#{myInsertMode}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_cols="
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RDSToS3HintViewRequests",
            "Name": "RDSToS3HintViewRequests",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "CopyActivity"
              },
              {
                "Key": "input",
                "RefValue": "RDSHintViewRequests"
              },
              {
                "Key": "output",
                "RefValue": "S3HintViewRequests"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3ToRedshiftHintViewRequests",
            "Name": "S3ToRedshiftHintViewRequests",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftCopyActivity"
              },
              {
                "Key": "dependsOn",
                "RefValue": "RedshiftCreateHintViewRequests"
              },
              {
                "Key": "dependsOn",
                "RefValue": "RDSToS3HintViewRequests"
              },
              {
                "Key": "input",
                "RefValue": "S3HintViewRequests"
              },
              {
                "Key": "output",
                "RefValue": "RedshiftHintViewRequests"
              },
              {
                "Key": "insertMode",
                "StringValue": "#{myInsertMode}"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RDSAuthoredHintViewRequests",
            "Name": "RDSAuthoredHintViewRequests",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "SqlDataNode"
              },
              {
                "Key": "database",
                "RefValue": "RDSDatabase"
              },
              {
                "Key": "table",
                "StringValue": "authored_hint_view_requests"
              },
              {
                "Key": "selectQuery",
                "StringValue": "select * from authored_hint_view_requests where #{myRDSTableLastModifiedCol} >= '#{format(@scheduledStartTime, 'YYYY-MM-dd HH-mm-ss')}' and #{myRDSTableLastModifiedCol} <= '#{format(@scheduledEndTime, 'YYYY-MM-dd HH-mm-ss')}'"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3AuthoredHintViewRequests",
            "Name": "S3AuthoredHintViewRequests",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "S3DataNode"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              },
              {
                "Key": "directoryPath",
                "StringValue": "#{myS3StagingLoc}/#{format(@scheduledStartTime, 'YYYY-MM-dd-HH-mm-ss')}/authored_hint_view_requests"
              }
            ]
          },
          {
            "Id": "RedshiftAuthoredHintViewRequests",
            "Name": "RedshiftAuthoredHintViewRequests",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftDataNode"
              },
              {
                "Key": "database",
                "RefValue": "RedshiftCluster"
              },
              {
                "Key": "tableName",
                "StringValue": "authored_hint_view_requests"
              },
              {
                "Key": "schemaName",
                "StringValue": "dashboard"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RedshiftCreateAuthoredHintViewRequests",
            "Name": "RedshiftCreateAuthoredHintViewRequests",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "ShellCommandActivity"
              },
              {
                "Key": "input",
                "RefValue": "RDSAuthoredHintViewRequests"
              },
              {
                "Key": "output",
                "RefValue": "RedshiftAuthoredHintViewRequests"
              },
              {
                "Key": "scriptUri",
                "StringValue": "s3://cdo-dist/dbconv.sh"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_jdbc=#{myRDSJdbcConnectStr}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_tbl=authored_hint_view_requests"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_pwd=#{*myRDSPassword}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_usr=#{myRDSUsername}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_jdbc=#{myRedshiftJdbcConnectStr}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_usr=#{myRedshiftUsername}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_pwd=#{*myRedshiftPassword}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_tbl=dashboard.authored_hint_view_requests"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_dist=#{myRedshiftDistributionKey}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_sort=#{myRedshiftSortKeys}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_map=#{myRedshiftTypeConvOverrideMap}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_ins=#{myInsertMode}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_cols="
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RDSToS3AuthoredHintViewRequests",
            "Name": "RDSToS3AuthoredHintViewRequests",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "CopyActivity"
              },
              {
                "Key": "input",
                "RefValue": "RDSAuthoredHintViewRequests"
              },
              {
                "Key": "output",
                "RefValue": "S3AuthoredHintViewRequests"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3ToRedshiftAuthoredHintViewRequests",
            "Name": "S3ToRedshiftAuthoredHintViewRequests",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftCopyActivity"
              },
              {
                "Key": "dependsOn",
                "RefValue": "RedshiftCreateAuthoredHintViewRequests"
              },
              {
                "Key": "dependsOn",
                "RefValue": "RDSToS3AuthoredHintViewRequests"
              },
              {
                "Key": "input",
                "RefValue": "S3AuthoredHintViewRequests"
              },
              {
                "Key": "output",
                "RefValue": "RedshiftAuthoredHintViewRequests"
              },
              {
                "Key": "insertMode",
                "StringValue": "#{myInsertMode}"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RDSLevelConceptDifficulties",
            "Name": "RDSLevelConceptDifficulties",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "SqlDataNode"
              },
              {
                "Key": "database",
                "RefValue": "RDSDatabase"
              },
              {
                "Key": "table",
                "StringValue": "level_concept_difficulties"
              },
              {
                "Key": "selectQuery",
                "StringValue": "select * from level_concept_difficulties where #{myRDSTableLastModifiedCol} >= '#{format(@scheduledStartTime, 'YYYY-MM-dd HH-mm-ss')}' and #{myRDSTableLastModifiedCol} <= '#{format(@scheduledEndTime, 'YYYY-MM-dd HH-mm-ss')}'"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3LevelConceptDifficulties",
            "Name": "S3LevelConceptDifficulties",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "S3DataNode"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              },
              {
                "Key": "directoryPath",
                "StringValue": "#{myS3StagingLoc}/#{format(@scheduledStartTime, 'YYYY-MM-dd-HH-mm-ss')}/level_concept_difficulties"
              }
            ]
          },
          {
            "Id": "RedshiftLevelConceptDifficulties",
            "Name": "RedshiftLevelConceptDifficulties",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftDataNode"
              },
              {
                "Key": "database",
                "RefValue": "RedshiftCluster"
              },
              {
                "Key": "tableName",
                "StringValue": "level_concept_difficulties"
              },
              {
                "Key": "schemaName",
                "StringValue": "dashboard"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RedshiftCreateLevelConceptDifficulties",
            "Name": "RedshiftCreateLevelConceptDifficulties",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "ShellCommandActivity"
              },
              {
                "Key": "input",
                "RefValue": "RDSLevelConceptDifficulties"
              },
              {
                "Key": "output",
                "RefValue": "RedshiftLevelConceptDifficulties"
              },
              {
                "Key": "scriptUri",
                "StringValue": "s3://cdo-dist/dbconv.sh"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_jdbc=#{myRDSJdbcConnectStr}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_tbl=level_concept_difficulties"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_pwd=#{*myRDSPassword}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_usr=#{myRDSUsername}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_jdbc=#{myRedshiftJdbcConnectStr}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_usr=#{myRedshiftUsername}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_pwd=#{*myRedshiftPassword}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_tbl=dashboard.level_concept_difficulties"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_dist=#{myRedshiftDistributionKey}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_sort=#{myRedshiftSortKeys}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_map=#{myRedshiftTypeConvOverrideMap}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_ins=#{myInsertMode}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_cols="
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RDSToS3LevelConceptDifficulties",
            "Name": "RDSToS3LevelConceptDifficulties",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "CopyActivity"
              },
              {
                "Key": "input",
                "RefValue": "RDSLevelConceptDifficulties"
              },
              {
                "Key": "output",
                "RefValue": "S3LevelConceptDifficulties"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3ToRedshiftLevelConceptDifficulties",
            "Name": "S3ToRedshiftLevelConceptDifficulties",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftCopyActivity"
              },
              {
                "Key": "dependsOn",
                "RefValue": "RedshiftCreateLevelConceptDifficulties"
              },
              {
                "Key": "dependsOn",
                "RefValue": "RDSToS3LevelConceptDifficulties"
              },
              {
                "Key": "input",
                "RefValue": "S3LevelConceptDifficulties"
              },
              {
                "Key": "output",
                "RefValue": "RedshiftLevelConceptDifficulties"
              },
              {
                "Key": "insertMode",
                "StringValue": "#{myInsertMode}"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RDSSurveyResults",
            "Name": "RDSSurveyResults",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "SqlDataNode"
              },
              {
                "Key": "database",
                "RefValue": "RDSDatabase"
              },
              {
                "Key": "table",
                "StringValue": "survey_results"
              },
              {
                "Key": "selectQuery",
                "StringValue": "select * from survey_results where #{myRDSTableLastModifiedCol} >= '#{format(@scheduledStartTime, 'YYYY-MM-dd HH-mm-ss')}' and #{myRDSTableLastModifiedCol} <= '#{format(@scheduledEndTime, 'YYYY-MM-dd HH-mm-ss')}'"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3SurveyResults",
            "Name": "S3SurveyResults",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "S3DataNode"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              },
              {
                "Key": "directoryPath",
                "StringValue": "#{myS3StagingLoc}/#{format(@scheduledStartTime, 'YYYY-MM-dd-HH-mm-ss')}/survey_results"
              }
            ]
          },
          {
            "Id": "RedshiftSurveyResults",
            "Name": "RedshiftSurveyResults",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftDataNode"
              },
              {
                "Key": "database",
                "RefValue": "RedshiftCluster"
              },
              {
                "Key": "tableName",
                "StringValue": "survey_results"
              },
              {
                "Key": "schemaName",
                "StringValue": "dashboard"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RedshiftCreateSurveyResults",
            "Name": "RedshiftCreateSurveyResults",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "ShellCommandActivity"
              },
              {
                "Key": "input",
                "RefValue": "RDSSurveyResults"
              },
              {
                "Key": "output",
                "RefValue": "RedshiftSurveyResults"
              },
              {
                "Key": "scriptUri",
                "StringValue": "s3://cdo-dist/dbconv.sh"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_jdbc=#{myRDSJdbcConnectStr}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_tbl=survey_results"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_pwd=#{*myRDSPassword}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_usr=#{myRDSUsername}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_jdbc=#{myRedshiftJdbcConnectStr}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_usr=#{myRedshiftUsername}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_pwd=#{*myRedshiftPassword}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_tbl=dashboard.survey_results"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_dist=#{myRedshiftDistributionKey}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_sort=#{myRedshiftSortKeys}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_map=#{myRedshiftTypeConvOverrideMap}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_ins=#{myInsertMode}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_cols="
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RDSToS3SurveyResults",
            "Name": "RDSToS3SurveyResults",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "CopyActivity"
              },
              {
                "Key": "input",
                "RefValue": "RDSSurveyResults"
              },
              {
                "Key": "output",
                "RefValue": "S3SurveyResults"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3ToRedshiftSurveyResults",
            "Name": "S3ToRedshiftSurveyResults",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftCopyActivity"
              },
              {
                "Key": "dependsOn",
                "RefValue": "RedshiftCreateSurveyResults"
              },
              {
                "Key": "dependsOn",
                "RefValue": "RDSToS3SurveyResults"
              },
              {
                "Key": "input",
                "RefValue": "S3SurveyResults"
              },
              {
                "Key": "output",
                "RefValue": "RedshiftSurveyResults"
              },
              {
                "Key": "insertMode",
                "StringValue": "#{myInsertMode}"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RDSSections",
            "Name": "RDSSections",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "SqlDataNode"
              },
              {
                "Key": "database",
                "RefValue": "RDSDatabase"
              },
              {
                "Key": "table",
                "StringValue": "sections"
              },
              {
                "Key": "selectQuery",
                "StringValue": "select * from sections where #{myRDSTableLastModifiedCol} >= '#{format(@scheduledStartTime, 'YYYY-MM-dd HH-mm-ss')}' and #{myRDSTableLastModifiedCol} <= '#{format(@scheduledEndTime, 'YYYY-MM-dd HH-mm-ss')}'"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3Sections",
            "Name": "S3Sections",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "S3DataNode"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              },
              {
                "Key": "directoryPath",
                "StringValue": "#{myS3StagingLoc}/#{format(@scheduledStartTime, 'YYYY-MM-dd-HH-mm-ss')}/sections"
              }
            ]
          },
          {
            "Id": "RedshiftSections",
            "Name": "RedshiftSections",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftDataNode"
              },
              {
                "Key": "database",
                "RefValue": "RedshiftCluster"
              },
              {
                "Key": "tableName",
                "StringValue": "sections"
              },
              {
                "Key": "schemaName",
                "StringValue": "dashboard"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RedshiftCreateSections",
            "Name": "RedshiftCreateSections",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "ShellCommandActivity"
              },
              {
                "Key": "input",
                "RefValue": "RDSSections"
              },
              {
                "Key": "output",
                "RefValue": "RedshiftSections"
              },
              {
                "Key": "scriptUri",
                "StringValue": "s3://cdo-dist/dbconv.sh"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_jdbc=#{myRDSJdbcConnectStr}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_tbl=sections"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_pwd=#{*myRDSPassword}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_usr=#{myRDSUsername}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_jdbc=#{myRedshiftJdbcConnectStr}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_usr=#{myRedshiftUsername}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_pwd=#{*myRedshiftPassword}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_tbl=dashboard.sections"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_dist=#{myRedshiftDistributionKey}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_sort=#{myRedshiftSortKeys}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_map=#{myRedshiftTypeConvOverrideMap}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_ins=#{myInsertMode}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_cols="
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RDSToS3Sections",
            "Name": "RDSToS3Sections",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "CopyActivity"
              },
              {
                "Key": "input",
                "RefValue": "RDSSections"
              },
              {
                "Key": "output",
                "RefValue": "S3Sections"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3ToRedshiftSections",
            "Name": "S3ToRedshiftSections",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftCopyActivity"
              },
              {
                "Key": "dependsOn",
                "RefValue": "RedshiftCreateSections"
              },
              {
                "Key": "dependsOn",
                "RefValue": "RDSToS3Sections"
              },
              {
                "Key": "input",
                "RefValue": "S3Sections"
              },
              {
                "Key": "output",
                "RefValue": "RedshiftSections"
              },
              {
                "Key": "insertMode",
                "StringValue": "#{myInsertMode}"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RDSUsers",
            "Name": "RDSUsers",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "SqlDataNode"
              },
              {
                "Key": "database",
                "RefValue": "RDSDatabase"
              },
              {
                "Key": "table",
                "StringValue": "users"
              },
              {
                "Key": "selectQuery",
                "StringValue": "select id,deleted_at,created_at,updated_at,current_sign_in_at,last_sign_in_at,sign_in_count,admin,user_type,gender,birthday,locale,total_lines from users where #{myRDSTableLastModifiedCol} >= '#{format(@scheduledStartTime, 'YYYY-MM-dd HH-mm-ss')}' and #{myRDSTableLastModifiedCol} <= '#{format(@scheduledEndTime, 'YYYY-MM-dd HH-mm-ss')}'"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3Users",
            "Name": "S3Users",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "S3DataNode"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              },
              {
                "Key": "directoryPath",
                "StringValue": "#{myS3StagingLoc}/#{format(@scheduledStartTime, 'YYYY-MM-dd-HH-mm-ss')}/users"
              }
            ]
          },
          {
            "Id": "RedshiftUsers",
            "Name": "RedshiftUsers",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftDataNode"
              },
              {
                "Key": "database",
                "RefValue": "RedshiftCluster"
              },
              {
                "Key": "tableName",
                "StringValue": "users"
              },
              {
                "Key": "schemaName",
                "StringValue": "dashboard"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RedshiftCreateUsers",
            "Name": "RedshiftCreateUsers",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "ShellCommandActivity"
              },
              {
                "Key": "input",
                "RefValue": "RDSUsers"
              },
              {
                "Key": "output",
                "RefValue": "RedshiftUsers"
              },
              {
                "Key": "scriptUri",
                "StringValue": "s3://cdo-dist/dbconv.sh"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_jdbc=#{myRDSJdbcConnectStr}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_tbl=users"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_pwd=#{*myRDSPassword}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_usr=#{myRDSUsername}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_jdbc=#{myRedshiftJdbcConnectStr}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_usr=#{myRedshiftUsername}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_pwd=#{*myRedshiftPassword}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_tbl=dashboard.users"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_dist=#{myRedshiftDistributionKey}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_sort=#{myRedshiftSortKeys}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_map=#{myRedshiftTypeConvOverrideMap}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_ins=#{myInsertMode}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_cols=id,deleted_at,created_at,updated_at,current_sign_in_at,last_sign_in_at,sign_in_count,admin,user_type,gender,birthday,locale,total_lines"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RDSToS3Users",
            "Name": "RDSToS3Users",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "CopyActivity"
              },
              {
                "Key": "input",
                "RefValue": "RDSUsers"
              },
              {
                "Key": "output",
                "RefValue": "S3Users"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3ToRedshiftUsers",
            "Name": "S3ToRedshiftUsers",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftCopyActivity"
              },
              {
                "Key": "dependsOn",
                "RefValue": "RedshiftCreateUsers"
              },
              {
                "Key": "dependsOn",
                "RefValue": "RDSToS3Users"
              },
              {
                "Key": "input",
                "RefValue": "S3Users"
              },
              {
                "Key": "output",
                "RefValue": "RedshiftUsers"
              },
              {
                "Key": "insertMode",
                "StringValue": "#{myInsertMode}"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },

          {
            "Id": "S3",
            "Name": "S3",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "S3DataNode"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              },
              {
                "Key": "directoryPath",
                "StringValue": "#{myS3StagingLoc}/#{format(@scheduledStartTime, 'YYYY-MM-dd-HH-mm-ss')}"
              }
            ]
          },
          {
            "Id": "S3Cleanup",
            "Name": "S3Cleanup",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "ShellCommandActivity"
              },
              {
                "Key": "input",
                "RefValue": "S3"
              },
              {
                "Key": "dependsOn",
                "RefValue": "S3ToRedshiftScripts"
              },
              {
                "Key": "dependsOn",
                "RefValue": "S3ToRedshiftFollowers"
              },
              {
                "Key": "dependsOn",
                "RefValue": "S3ToRedshiftStages"
              },
              {
                "Key": "dependsOn",
                "RefValue": "S3ToRedshiftScriptLevels"
              },
              {
                "Key": "dependsOn",
                "RefValue": "S3ToRedshiftWorkshops"
              },
              {
                "Key": "dependsOn",
                "RefValue": "S3ToRedshiftSegments"
              },
              {
                "Key": "dependsOn",
                "RefValue": "S3ToRedshiftPuzzleRatings"
              },
              {
                "Key": "dependsOn",
                "RefValue": "S3ToRedshiftUserScripts"
              },
              {
                "Key": "dependsOn",
                "RefValue": "S3ToRedshiftChannelTokens"
              },
              {
                "Key": "dependsOn",
                "RefValue": "S3ToRedshiftLevels"
              },
              {
                "Key": "dependsOn",
                "RefValue": "S3ToRedshiftUserProficiencies"
              },
              {
                "Key": "dependsOn",
                "RefValue": "S3ToRedshiftWorkshopAttendance"
              },
              {
                "Key": "dependsOn",
                "RefValue": "S3ToRedshiftHintViewRequests"
              },
              {
                "Key": "dependsOn",
                "RefValue": "S3ToRedshiftAuthoredHintViewRequests"
              },
              {
                "Key": "dependsOn",
                "RefValue": "S3ToRedshiftLevelConceptDifficulties"
              },
              {
                "Key": "dependsOn",
                "RefValue": "S3ToRedshiftSurveyResults"
              },
              {
                "Key": "dependsOn",
                "RefValue": "S3ToRedshiftSections"
              },
              {
                "Key": "dependsOn",
                "RefValue": "S3ToRedshiftUsers"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "command",
                "StringValue": "(sudo yum -y update aws-cli) && (aws s3 rm #{input.directoryPath} --recursive)"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          }
        ]
      }
    },
    "RDSSyncPegasus": {
      "Type": "AWS::DataPipeline::Pipeline",
      "Properties": {
        "Name": "rds-to-redshift-pegasus",
        "Description": "Sync RDS-pegasus to Redshift",
        "ParameterObjects": [
          {
            "Id": "*myRDSPassword",
            "Attributes": [
              {
                "Key": "description",
                "StringValue": "RDS MySQL password"
              },
              {
                "Key": "type",
                "StringValue": "String"
              }
            ]
          },
          {
            "Id": "myRedshiftUsername",
            "Attributes": [
              {
                "Key": "description",
                "StringValue": "Redshift username"
              },
              {
                "Key": "type",
                "StringValue": "String"
              }
            ]
          },
          {
            "Id": "myRDSJdbcConnectStr",
            "Attributes": [
              {
                "Key": "watermark",
                "StringValue": "jdbc:mysql://dbinstance.id.region.rds.amazonaws.com:3306/dbname"
              },
              {
                "Key": "description",
                "StringValue": "RDS MySQL connection string"
              },
              {
                "Key": "type",
                "StringValue": "String"
              }
            ]
          },
          {
            "Id": "myS3StagingLoc",
            "Attributes": [
              {
                "Key": "helpText",
                "StringValue": "The S3 folder to store RDS MySQL table data before loading to Redshift. The S3 folder must be in the same region as the Redshift cluster."
              },
              {
                "Key": "description",
                "StringValue": "S3 staging folder"
              },
              {
                "Key": "type",
                "StringValue": "AWS::S3::ObjectKey"
              }
            ]
          },
          {
            "Id": "myRedshiftTypeConvOverrideMap",
            "Attributes": [
              {
                "Key": "helpText",
                "StringValue": "Override the default mapping of RDS MySQL data types to Redshift data types."
              },
              {
                "Key": "watermark",
                "StringValue": "tinyint(1):smallint,char(35):varchar(70),bigint(20) unsigned:bigint"
              },
              {
                "Key": "description",
                "StringValue": "MySQL to Redshift type conversion overrides"
              },
              {
                "Key": "optional",
                "StringValue": "true"
              },
              {
                "Key": "type",
                "StringValue": "String"
              }
            ]
          },
          {
            "Id": "myRedshiftDistributionKey",
            "Attributes": [
              {
                "Key": "watermark",
                "StringValue": "columnName"
              },
              {
                "Key": "helpText",
                "StringValue": "Distribution key column in the Redshift table. If the distribution key is not specified, the primary key is set as a distribution key."
              },
              {
                "Key": "description",
                "StringValue": "Redshift table distribution key"
              },
              {
                "Key": "optional",
                "StringValue": "true"
              },
              {
                "Key": "type",
                "StringValue": "String"
              }
            ]
          },
          {
            "Id": "myInsertMode",
            "Attributes": [
              {
                "Key": "default",
                "StringValue": "OVERWRITE_EXISTING"
              },
              {
                "Key": "helpLink",
                "StringValue": "https://docs.aws.amazon.com/console/datapipeline/redshiftcopyactivity"
              },
              {
                "Key": "helpText",
                "StringValue": "Determines how to handle pre-existing data in the target table that overlaps with rows in the data to be loaded."
              },
              {
                "Key": "description",
                "StringValue": "Redshift table insert mode"
              },
              {
                "Key": "type",
                "StringValue": "String"
              }
            ]
          },
          {
            "Id": "*myRedshiftPassword",
            "Attributes": [
              {
                "Key": "description",
                "StringValue": "Redshift password"
              },
              {
                "Key": "type",
                "StringValue": "String"
              }
            ]
          },
          {
            "Id": "myRDSTableLastModifiedCol",
            "Attributes": [
              {
                "Key": "helpText",
                "StringValue": "Name of the column that stores the last modified time value in the RDS MySQL table."
              },
              {
                "Key": "description",
                "StringValue": "Last modified column name"
              },
              {
                "Key": "type",
                "StringValue": "String"
              }
            ]
          },
          {
            "Id": "myRDSRedshiftSecurityGrps",
            "Attributes": [
              {
                "Key": "default",
                "StringValue": "default"
              },
              {
                "Key": "watermark",
                "StringValue": "security group name"
              },
              {
                "Key": "helpText",
                "StringValue": "The names of one or more security groups that collectively provide the EC2 instance connectivity to both the RDS instance and Redshift cluster."
              },
              {
                "Key": "description",
                "StringValue": "RDS and Redshift security group(s)"
              },
              {
                "Key": "isArray",
                "StringValue": "true"
              },
              {
                "Key": "type",
                "StringValue": "String"
              }
            ]
          },
          {
            "Id": "myRDSUsername",
            "Attributes": [
              {
                "Key": "description",
                "StringValue": "RDS MySQL username"
              },
              {
                "Key": "type",
                "StringValue": "String"
              }
            ]
          },
          {
            "Id": "myRedshiftSortKeys",
            "Attributes": [
              {
                "Key": "watermark",
                "StringValue": "columnName1,columnName2"
              },
              {
                "Key": "helpText",
                "StringValue": "Sort key columns in the Redshift table."
              },
              {
                "Key": "description",
                "StringValue": "Redshift table sort keys"
              },
              {
                "Key": "optional",
                "StringValue": "true"
              },
              {
                "Key": "type",
                "StringValue": "String"
              }
            ]
          },
          {
            "Id": "myRedshiftJdbcConnectStr",
            "Attributes": [
              {
                "Key": "watermark",
                "StringValue": "jdbc:postgresql://endpoint:port/database?tcpKeepAlive=true"
              },
              {
                "Key": "description",
                "StringValue": "Redshift JDBC connection string"
              },
              {
                "Key": "type",
                "StringValue": "String"
              }
            ]
          }
        ],
        "ParameterValues": [
          {
            "Id": "myS3StagingLoc",
            "StringValue": {
              "Fn::Join": [
                "/",
                [
                  {
                    "Ref": "RedshiftS3"
                  },
                  "pegasus"
                ]
              ]
            }
          },
          {
            "Id": "myRDSTableLastModifiedCol",
            "StringValue": "updated_at"
          },
          {
            "Id": "myRDSJdbcConnectStr",
            "StringValue": {
              "Fn::Join": [
                "",
                [
                  "jdbc:mysql://",
                  {
                    "Ref": "RDSHostname"
                  },
                  ":",
                  {
                    "Ref": "RDSPort"
                  },
                  "/",
                  "pegasus"
                ]
              ]
            }
          },
          {
            "Id": "myRDSUsername",
            "StringValue": {
              "Ref": "RDSUsername"
            }
          },
          {
            "Id": "*myRDSPassword",
            "StringValue": {
              "Ref": "RDSPassword"
            }
          },
          {
            "Id": "myRDSRedshiftSecurityGrps",
            "StringValue": {
              "Fn::GetAtt": [
                "VPC",
                "FrontendSecurityGroup"
              ]
            }
          },
          {
            "Id": "myRedshiftJdbcConnectStr",
            "StringValue": {
              "Fn::Join": [
                "",
                [
                  "jdbc:redshift://",
                  {
                    "Fn::GetAtt": [
                      "Tableau",
                      "Endpoint.Address"
                    ]
                  },
                  ":",
                  {
                    "Fn::GetAtt": [
                      "Tableau",
                      "Endpoint.Port"
                    ]
                  },
                  "/",
                  {
                    "Ref": "RedshiftDatabase"
                  },
                  "?tcpKeepAlive=true"
                ]
              ]
            }
          },
          {
            "Id": "myRedshiftUsername",
            "StringValue": {
              "Ref": "RedshiftUsername"
            }
          },
          {
            "Id": "*myRedshiftPassword",
            "StringValue": {
              "Ref": "RedshiftPassword"
            }
          },
          {
            "Id": "myInsertMode",
            "StringValue": "OVERWRITE_EXISTING"
          },
          {
            "Id": "myEc2InstanceSubnet",
            "StringValue": {
              "Fn::GetAtt": [
                "VPC",
                "SubnetB"
              ]
            }
          }
        ],
        "PipelineObjects": [
          {
            "Id": "Default",
            "Name": "Default",
            "Fields": [
              {
                "Key": "failureAndRerunMode",
                "StringValue": "CASCADE"
              },
              {
                "Key": "schedule",
                "RefValue": "DefaultSchedule"
              },
              {
                "Key": "resourceRole",
                "StringValue": "DataPipelineDefaultResourceRole"
              },
              {
                "Key": "role",
                "StringValue": "DataPipelineDefaultRole"
              },
              {
                "Key": "pipelineLogUri",
                "StringValue": "s3://redshift-tableau"
              },
              {
                "Key": "scheduleType",
                "StringValue": "cron"
              },
              {
                "Key": "type",
                "StringValue": "Default"
              }
            ]
          },
          {
            "Id": "DefaultSchedule",
            "Name": "Every 1 day",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "Schedule"
              },
              {
                "Key": "period",
                "StringValue": "1 days"
              },
              {
                "Key": "startDateTime",
                "StringValue": "2016-06-27T07:45:00"
              }
            ]
          },
          {
            "Id": "Ec2Instance",
            "Name": "Ec2Instance",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "Ec2Resource"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              },
              {
                "Key": "actionOnTaskFailure",
                "StringValue": "terminate"
              },
              {
                "Key": "terminateAfter",
                "StringValue": "2 Hours"
              },
              {
                "Key": "subnetId",
                "StringValue": "#{myEc2InstanceSubnet}"
              },
              {
                "Key": "securityGroupIds",
                "StringValue": "#{myRDSRedshiftSecurityGrps}"
              }
            ]
          },
          {
            "Id": "RDSDatabase",
            "Name": "RDSDatabase",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "JdbcDatabase"
              },
              {
                "Key": "jdbcProperties",
                "StringValue": "allowMultiQueries=true"
              },
              {
                "Key": "jdbcDriverClass",
                "StringValue": "com.mysql.jdbc.Driver"
              },
              {
                "Key": "connectionString",
                "StringValue": "#{myRDSJdbcConnectStr}"
              },
              {
                "Key": "username",
                "StringValue": "#{myRDSUsername}"
              },
              {
                "Key": "*password",
                "StringValue": "#{*myRDSPassword}"
              }
            ]
          },
          {
            "Id": "RedshiftCluster",
            "Name": "RedshiftCluster",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftDatabase"
              },
              {
                "Key": "connectionString",
                "StringValue": "#{myRedshiftJdbcConnectStr}"
              },
              {
                "Key": "*password",
                "StringValue": "#{*myRedshiftPassword}"
              },
              {
                "Key": "username",
                "StringValue": "#{myRedshiftUsername}"
              }
            ]
          },
          {
            "Id": "RDSStorageApps",
            "Name": "RDSStorageApps",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "SqlDataNode"
              },
              {
                "Key": "database",
                "RefValue": "RDSDatabase"
              },
              {
                "Key": "table",
                "StringValue": "storage_apps"
              },
              {
                "Key": "selectQuery",
                "StringValue": "select * from storage_apps where #{myRDSTableLastModifiedCol} >= '#{format(@scheduledStartTime, 'YYYY-MM-dd HH-mm-ss')}' and #{myRDSTableLastModifiedCol} <= '#{format(@scheduledEndTime, 'YYYY-MM-dd HH-mm-ss')}'"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3StorageApps",
            "Name": "S3StorageApps",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "S3DataNode"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              },
              {
                "Key": "directoryPath",
                "StringValue": "#{myS3StagingLoc}/#{format(@scheduledStartTime, 'YYYY-MM-dd-HH-mm-ss')}/storage_apps"
              }
            ]
          },
          {
            "Id": "RedshiftStorageApps",
            "Name": "RedshiftStorageApps",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftDataNode"
              },
              {
                "Key": "database",
                "RefValue": "RedshiftCluster"
              },
              {
                "Key": "tableName",
                "StringValue": "storage_apps"
              },
              {
                "Key": "schemaName",
                "StringValue": "pegasus"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RedshiftCreateStorageApps",
            "Name": "RedshiftCreateStorageApps",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "ShellCommandActivity"
              },
              {
                "Key": "input",
                "RefValue": "RDSStorageApps"
              },
              {
                "Key": "output",
                "RefValue": "RedshiftStorageApps"
              },
              {
                "Key": "scriptUri",
                "StringValue": "s3://cdo-dist/dbconv.sh"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_jdbc=#{myRDSJdbcConnectStr}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_tbl=storage_apps"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_pwd=#{*myRDSPassword}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_usr=#{myRDSUsername}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_jdbc=#{myRedshiftJdbcConnectStr}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_usr=#{myRedshiftUsername}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_pwd=#{*myRedshiftPassword}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_tbl=pegasus.storage_apps"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_dist=#{myRedshiftDistributionKey}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_sort=#{myRedshiftSortKeys}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_map=#{myRedshiftTypeConvOverrideMap}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_ins=#{myInsertMode}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_cols="
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RDSToS3StorageApps",
            "Name": "RDSToS3StorageApps",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "CopyActivity"
              },
              {
                "Key": "input",
                "RefValue": "RDSStorageApps"
              },
              {
                "Key": "output",
                "RefValue": "S3StorageApps"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3ToRedshiftStorageApps",
            "Name": "S3ToRedshiftStorageApps",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftCopyActivity"
              },
              {
                "Key": "dependsOn",
                "RefValue": "RedshiftCreateStorageApps"
              },
              {
                "Key": "dependsOn",
                "RefValue": "RDSToS3StorageApps"
              },
              {
                "Key": "input",
                "RefValue": "S3StorageApps"
              },
              {
                "Key": "output",
                "RefValue": "RedshiftStorageApps"
              },
              {
                "Key": "insertMode",
                "StringValue": "#{myInsertMode}"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RDSForms",
            "Name": "RDSForms",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "SqlDataNode"
              },
              {
                "Key": "database",
                "RefValue": "RDSDatabase"
              },
              {
                "Key": "table",
                "StringValue": "forms"
              },
              {
                "Key": "selectQuery",
                "StringValue": "select * from forms where #{myRDSTableLastModifiedCol} >= '#{format(@scheduledStartTime, 'YYYY-MM-dd HH-mm-ss')}' and #{myRDSTableLastModifiedCol} <= '#{format(@scheduledEndTime, 'YYYY-MM-dd HH-mm-ss')}'"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3Forms",
            "Name": "S3Forms",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "S3DataNode"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              },
              {
                "Key": "directoryPath",
                "StringValue": "#{myS3StagingLoc}/#{format(@scheduledStartTime, 'YYYY-MM-dd-HH-mm-ss')}/forms"
              }
            ]
          },
          {
            "Id": "RedshiftForms",
            "Name": "RedshiftForms",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftDataNode"
              },
              {
                "Key": "database",
                "RefValue": "RedshiftCluster"
              },
              {
                "Key": "tableName",
                "StringValue": "forms"
              },
              {
                "Key": "schemaName",
                "StringValue": "pegasus"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RedshiftCreateForms",
            "Name": "RedshiftCreateForms",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "ShellCommandActivity"
              },
              {
                "Key": "input",
                "RefValue": "RDSForms"
              },
              {
                "Key": "output",
                "RefValue": "RedshiftForms"
              },
              {
                "Key": "scriptUri",
                "StringValue": "s3://cdo-dist/dbconv.sh"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_jdbc=#{myRDSJdbcConnectStr}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_tbl=forms"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_pwd=#{*myRDSPassword}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_usr=#{myRDSUsername}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_jdbc=#{myRedshiftJdbcConnectStr}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_usr=#{myRedshiftUsername}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_pwd=#{*myRedshiftPassword}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_tbl=pegasus.forms"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_dist=#{myRedshiftDistributionKey}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_sort=#{myRedshiftSortKeys}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_map=#{myRedshiftTypeConvOverrideMap}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--red_ins=#{myInsertMode}"
              },
              {
                "Key": "scriptArgument",
                "StringValue": "--rds_cols="
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "RDSToS3Forms",
            "Name": "RDSToS3Forms",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "CopyActivity"
              },
              {
                "Key": "input",
                "RefValue": "RDSForms"
              },
              {
                "Key": "output",
                "RefValue": "S3Forms"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3ToRedshiftForms",
            "Name": "S3ToRedshiftForms",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "RedshiftCopyActivity"
              },
              {
                "Key": "dependsOn",
                "RefValue": "RedshiftCreateForms"
              },
              {
                "Key": "dependsOn",
                "RefValue": "RDSToS3Forms"
              },
              {
                "Key": "input",
                "RefValue": "S3Forms"
              },
              {
                "Key": "output",
                "RefValue": "RedshiftForms"
              },
              {
                "Key": "insertMode",
                "StringValue": "#{myInsertMode}"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          },
          {
            "Id": "S3",
            "Name": "S3",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "S3DataNode"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              },
              {
                "Key": "directoryPath",
                "StringValue": "#{myS3StagingLoc}/#{format(@scheduledStartTime, 'YYYY-MM-dd-HH-mm-ss')}"
              }
            ]
          },
          {
            "Id": "S3Cleanup",
            "Name": "S3Cleanup",
            "Fields": [
              {
                "Key": "type",
                "StringValue": "ShellCommandActivity"
              },
              {
                "Key": "input",
                "RefValue": "S3"
              },
              {
                "Key": "dependsOn",
                "RefValue": "S3ToRedshiftStorageApps"
              },
              {
                "Key": "dependsOn",
                "RefValue": "S3ToRedshiftForms"
              },
              {
                "Key": "runsOn",
                "RefValue": "Ec2Instance"
              },
              {
                "Key": "command",
                "StringValue": "(sudo yum -y update aws-cli) && (aws s3 rm #{input.directoryPath} --recursive)"
              },
              {
                "Key": "scheduleType",
                "StringValue": "TIMESERIES"
              }
            ]
          }
        ]
      }
    }
  },
  "Outputs": {
    "Redshift": {
      "Description": "Tableau endpoint",
      "Value": {
        "Ref": "Tableau"
      }
    }
  }
}
