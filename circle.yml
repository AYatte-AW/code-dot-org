general:
  artifacts:
    - dashboard/test/ui
    - dashboard/log
    - pegasus/log
machine:
  ruby:
    version: 2.2.3
  node:
    version: 6.9
  java:
    version: openjdk8 # used for Applitools merge API tool
  environment:
    RAILS_ENV: test
    RACK_ENV: test
    SPROCKETS_DERAILLEUR_WORKER_COUNT: 2 # CircleCI build VMs have a memory limit of 8G
    DISABLE_SPRING: 1
  services:
    - docker
checkout:
  post:
    - case $CIRCLE_NODE_INDEX in 1) ./bin/circle/merge-eyes-baselines ;; *) echo "Skipping step." ;; esac:
    - case $CIRCLE_NODE_INDEX in 0) echo "Skipping step." ;; *) ./bin/circle/merge-base ;; esac:
dependencies:
  pre:
    - ./bin/circle/dependencies_pre.sh
  cache_directories:
    - "apps/node_modules"
    - "apps/.babel-cache"
    - "dashboard/tmp/cache"
    - "~/.rvm/gems/ruby-2.2.3"
    - ".tmputils"
    - "~/.yarn-cache"
  override:
    - ./bin/circle/dependencies_override.sh
database:
  override:
    - 'echo "Skipping database phase (already ran)."'
test:
  override:
    - ./bin/circle/test_override.sh:
      parallel: true
experimental:
  notify:
    branches:
      only:
        - staging
